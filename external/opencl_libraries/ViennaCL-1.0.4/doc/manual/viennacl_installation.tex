\chapter{Installation}

This chapter shows how {\ViennaCL} can be integrated into a project and how the
examples are built. The necessary steps are outlined for several different
platforms, but we could not check every possible combination of hardware,
operating system and compiler. If you experience any trouble, please write to
the maining list at \\
\begin{center}
\texttt{viennacl-support$@$lists.sourceforge.net} 
\end{center}


% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\section{Dependencies}
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\label{dependencies}
{\ViennaCL} uses the {\CMake} build system for multi-platform support.
Thus, before you proceed with the installation of {\ViennaCL}, make sure you
have a recent version of {\CMake} installed.

\begin{itemize}
 \item A recent C++ compiler (e.g.~{\GCC} version 4.2.x or above and Visual C++
2008 are known to work)
 \item {\OpenCL}~\cite{khronoscl,nvidiacl} for accessing compute devices (GPUs);
see Section~\ref{opencllibs} for details.
(optional, since iterative solvers can also be used with e.g.~{\ublas})
 \item {\CMake}~\cite{cmake} as build system (optional, but highly recommended
for building the examples)
% \item {\OpenMP}~\cite{openmp} for the benchmark suite (optional, but
%recommended for fair benchmarking)
 \item {\ublas} (shipped with {\Boost}~\cite{boost}) provides the same interface as {\ViennaCL} and allows to switch between CPU and GPU seamlessly, see the tutorials.
\end{itemize}

%The use of {\OpenMP} for the benchmark suite allows fair comparisons between your multi-core CPU and your compute device (e.g.~GPU).

\section{Generic Installation of ViennaCL} \label{sec:viennacl-installation}
Since {\ViennaCL} is a header-only library, it is sufficient to copy the folder
\lstinline|viennacl/| either into your project folder or to your global system
include path. On Unix based systems, this is often \lstinline|/usr/include/| or
\lstinline|/usr/local/include/|.

On Windows, the situation strongly depends on your development environment. We advise users
to consult the documentation of their compiler on how to set the include
path correctly. With Visual Studio this is usually something like \texttt{C:$\setminus$Program Files$\setminus$Microsoft Visual Studio 9.0$\setminus$VC$\setminus$include}
and can be set in \texttt{Tools -> Options -> Projects and Solutions -> VC++-\-Directories}. The include and library directories of your {\OpenCL} SDK should also be added there.

\NOTE{If multiple {\OpenCL} libraries are available on the host system, one has
to ensure that the intended one is used.}


% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\section{Get the {\OpenCL} Library}
\label{opencllibs}
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
The development of {\OpenCL} applications requires a corresponding library
(e.g.~\texttt{libOpenCL.so} under Unix based systems) and a suitable driver if
used on GPUs. This section describes how these can be acquired.

\TIP{Note, that for Mac OS X systems there is no need to install an {\OpenCL} 
capable driver and the corresponding library. 
The {\OpenCL} library is already present if a suitable graphics 
card is present. The setup of {\ViennaCL} on Mac OS X is discussed in
Section~\ref{apple}.}

\subsection{\NVIDIA Driver}
\NVIDIA provides the {\OpenCL} library with the GPU driver. Therefore, if a 
\NVIDIA driver is present on the system, the library is too. However, 
not all of the released drivers contain the {\OpenCL} library. 
A driver which is known to support {\OpenCL}, and hence providing the required
library, is $195.36.24$. 

\subsection{ATI Stream SDK} \label{sec:opencl-on-ati}
ATI provides the {\OpenCL} library with the Stream
SDK~\cite{atistream}. At the release of {\ViennaCLversion}, the latest Stream
SDK was $2.1$. If used with ATI GPUs, the ATI GPU drivers of version at least
$10.4$\footnote{Current ATI drivers
may not work with current kernel version. The presented tests are based on the 
$2.6.33$ kernel.} are required. If {\ViennaCL} is to be run on multi-core CPUs,
no additional GPU driver is required. The installation notes
of the SDK provides guidance throughout the
installation process~\cite{atistreamdocu}. 

\TIP{If the SDK is installed in a non-system wide location, the 
include and library paths have to be specified in the
\texttt{CMakeLists.txt} files. An example of how to set these paths is
provided in the file \texttt{CMakeLists.txt} around line 18. Be sure to add the
{\OpenCL} library path to the \texttt{LD\_LIBRARY\_PATH} environment variable.
Otherwise, linker errors will occur as the required library cannot be found.}

It is important to note that the ATI Stream SDK does not provide full 
double precision support~\cite{atidouble} on CPUs and GPUs, so it is only experimentally
available in {\ViennaCL}. This experimental mode is disabled by default, but can
be enabled for either CPUs or GPUs by defining one of the preprocessor constants
\begin{lstlisting}
// for CPUs:
#define VIENNACL_EXPERIMENTAL_DOUBLE_PRECISION_WITH_STREAM_SDK_ON_CPU
// for GPUs:
#define VIENNACL_EXPERIMENTAL_DOUBLE_PRECISION_WITH_STREAM_SDK_ON_GPU
\end{lstlisting}
prior to any inclusion of {\ViennaCL} header files.

\NOTE{Some compute kernels may not work as expected in the experimental double
precision mode in the ATI Stream SDK. Moreover, the functions \texttt{norm\_1}, \texttt{norm\_2}, \texttt{norm\_inf} and \texttt{index\_norm\_inf} are not available on GPUs in double precision using ATI Stream SDK.}

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\section{Building the Examples and Tutorials}
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
For building the examples, we suppose that {\CMake} is properly set up
on your system. The other dependencies are listed in Tab.~\ref{tab:tutorial-dependencies}.

\begin{table}[tb]
\begin{center}
\begin{tabular}{l|l}
Tutorial No. & Dependencies\\
\hline
\texttt{tutorial/tut1.cpp}      & {\OpenCL} \\
\texttt{tutorial/tut2.cpp}      & {\OpenCL}, {\ublas} \\
\texttt{tutorial/tut3.cpp}      & {\OpenCL}, {\ublas} \\
\texttt{tutorial/tut4.cpp}      & {\ublas} \\
\texttt{tutorial/tut5.cpp}      & {\OpenCL} \\
\texttt{benchmarks/vector.cpp}  & {\OpenCL} \\
\texttt{benchmarks/sparse.cpp}  & {\OpenCL}, {\ublas} \\
\texttt{benchmarks/solver.cpp}  & {\OpenCL}, {\ublas} \\
\end{tabular}
\caption{Dependencies for the examples in the \texttt{examples/} folder}
\label{tab:tutorial-dependencies}
\end{center}
\end{table}

\subsection{Linux}
To build the examples, open a terminal and change to:

\begin{exaipd}
\begin{Verbatim}
$> cd /your-ViennaCL-path/build/
\end{Verbatim}
\end{exaipd}

Execute

\begin{exaipd}
\begin{Verbatim}
$> cmake ..
\end{Verbatim}
\end{exaipd}

to obtain a Makefile.
Executing

\begin{exaipd}
\begin{Verbatim}
$> make 
\end{Verbatim}
\end{exaipd}

builds the examples. If some of the dependencies in Tab.~\ref{tab:tutorial-dependencies} are not fulfilled, you can build each example separately:
\begin{exaipd}
\begin{Verbatim}
$> make tut1              #builds tutorial 1
$> make vectorbench       #builds vector benchmarks
\end{Verbatim}
\end{exaipd}


\TIP{Speed up the building process by using jobs, e.g. \keyword{make -j4}.}

\subsection{Mac OS X}
\label{apple}
The tools mentioned in Section \ref{dependencies} are available on 
macintosh platforms too. 
For the {\GCC} compiler the Xcode~\cite{xcode} package has to be installed.
To install {\CMake} and {\Boost} external portation tools have to be used, 
for example, Fink~\cite{fink}, DarwinPorts~\cite{darwinports} 
or MacPorts~\cite{macports}. Such portation tools provide the 
aforementioned packages, {\CMake} and {\Boost}, for macintosh platforms. 

\TIP{If the {\CMake} build system has problems detecting your {\Boost} libraries, 
determine the location of your {\Boost} folder. 
Open the \texttt{CMakeLists.txt} file in the root directory of {\ViennaCL} and 
add your {\Boost} path after the following entry: 
\texttt{IF(\${CMAKE\_SYSTEM\_NAME} MATCHES "Darwin")} }

The build process of {\ViennaCL} is similar to Linux.

\subsection{Windows}
In the following the procedure is outlined for \texttt{Visual Studio}: Assuming that an {\OpenCL} SDK and {\CMake} is already installed, Visual Studio solution and project files can be created using {\CMake}:
\begin{itemize}
\item Open the {\CMake} GUI.
\item Set the {\ViennaCL} base directory as source directory.
\item Set the \texttt{build/} directory as build directory.
\item Click on 'Configure' and select the appropriate generator (e.g.~\texttt{Visual Studio 9 2008})
\item Click on 'Generate' (you may need to click on 'Configure' one more time before you can click on 'Generate')
\item The project files can now be found in the {\ViennaCL} build directory, where they can be opened and compiled with Visual Studio (provided that the include and library paths are set correctly, see Sec.~\ref{sec:viennacl-installation}).
\end{itemize}

\TIP{The examples and tutorials should be executed from within the \texttt{build/} directory of {\ViennaCL}, otherwise the sample data files cannot be found.}

























